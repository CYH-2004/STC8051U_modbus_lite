C251 COMPILER V5.60.0,  Uart1                                                              11/01/26  10:39:44  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE Uart1
OBJECT MODULE PLACED IN .\Objects\Uart1.obj
COMPILER INVOKED BY: D:\Software_D\Keil_v5\C251\BIN\C251.EXE Basic\Uart1.c XSMALL INTR2 BROWSE INCDIR(.\User;.\Modbus_li
                    -te;.\Library;.\Basic;.\SSD1306) DEBUG PRINT(.\Listings\Uart1.lst) TABS(2) OBJECT(.\Objects\Uart1.obj) 

stmt  level    source

    1          //´®¿ÚÍ¨ÐÅ³ÌÐòÒÆÖ²×Ô¹Ù·½Àý³Ì
    2          #include "Uart1.h"
    3          
    4          static u8  TX1_Cnt;    //·¢ËÍ¼ÆÊý
    5          static u8  RX1_Cnt;    //½ÓÊÕ¼ÆÊý
    6          static bit B_TX1_Busy; //·¢ËÍÃ¦±êÖ¾
    7          
    8          static u8  RX1_Buffer[UART1_BUF_LENGTH]; //½ÓÊÕ»º³å
    9          
   10          //========================================================================
   11          // º¯Êý: void UART1_config(u8 brt)
   12          // ÃèÊö: UART1³õÊ¼»¯º¯Êý¡£
   13          // ²ÎÊý: brt: Ñ¡Ôñ²¨ÌØÂÊ, 2: Ê¹ÓÃTimer2×ö²¨ÌØÂÊ, ÆäËüÖµ: Ê¹ÓÃTimer1×ö²¨ÌØÂÊ.
   14          // ·µ»Ø: none.
   15          // °æ±¾: VER1.0
   16          // ÈÕÆÚ: 2014-11-28
   17          // ±¸×¢: 
   18          //========================================================================
   19          
   20          void UART1_config(u8 pin)
   21          {
   22   1          /*********** ²¨ÌØÂÊÊ¹ÓÃ¶¨Ê±Æ÷1 *****************/
   23   1              TR1 = 0;
   24   1              S1BRT = 0;    //S1 BRT Use Timer1;
   25   1              T1_CT = 0;    //Timer1 set As Timer
   26   1              T1x12 = 1;    //Timer1 set as 1T mode
   27   1              TMOD &= ~0x30;//Timer1_16bitAutoReload;
   28   1              TH1 = (u8)(Baudrate1 / 256);
   29   1              TL1 = (u8)(Baudrate1 % 256);
   30   1              ET1 = 0;    //½ûÖ¹ÖÐ¶Ï
   31   1              TR1 = 1;
   32   1          /*************************************************/
   33   1      
   34   1          SCON = (SCON & 0x3f) | 0x40;    //UART1Ä£Ê½, 0x00: Í¬²½ÒÆÎ»Êä³ö, 0x40: 8Î»Êý¾Ý,¿É±ä²¨ÌØÂÊ, 0x80: 9Î»Ê
             -ý¾Ý,¹Ì¶¨²¨ÌØÂÊ, 0xc0: 9Î»Êý¾Ý,¿É±ä²¨ÌØÂÊ
   35   1      //  PS  = 1;    //¸ßÓÅÏÈ¼¶ÖÐ¶Ï
   36   1          ES  = 1;    //ÔÊÐíÖÐ¶Ï
   37   1          REN = 1;    //ÔÊÐí½ÓÊÕ
   38   1          P_SW1 &= 0x3f;
   39   1          P_SW1 |= 0x00;      //UART1 switch to, 0x00: P3.0 P3.1, 0x40: P3.6 P3.7, 0x80: P1.6 P1.7, 0xC0: P4.3 
             -P4.4
   40   1      
   41   1          B_TX1_Busy = 0;
   42   1          TX1_Cnt = 0;
   43   1          RX1_Cnt = 0;
   44   1      }
*** WARNING C47 IN LINE 20 OF Basic\Uart1.c: 'pin': unreferenced parameter
   45          
   46          //========================================================================
   47          // º¯Êý: void UART1_int (void) interrupt UART1_VECTOR
   48          // ÃèÊö: UART1ÖÐ¶Ïº¯Êý¡£
   49          // ²ÎÊý: none.
   50          // ·µ»Ø: none.
   51          // °æ±¾: VER1.0
   52          // ÈÕÆÚ: 2014-11-28
   53          // ±¸×¢: 
   54          //========================================================================
   55          void UART1_isr (void) interrupt 4
C251 COMPILER V5.60.0,  Uart1                                                              11/01/26  10:39:44  PAGE 2   

   56          {
   57   1          if(RI)
   58   1          {
   59   2              RI = 0;
   60   2              RX1_Buffer[RX1_Cnt] = SBUF;
   61   2              if(++RX1_Cnt >= UART1_BUF_LENGTH)   RX1_Cnt = 0;
   62   2          }
   63   1      
   64   1          if(TI)
   65   1          {
   66   2              TI = 0;
   67   2              B_TX1_Busy = 0;
   68   2          }
   69   1      }
   70          
   71          //========================================================================
   72          // º¯Êý: void PrintString1(u8 *puts)
   73          // ÃèÊö: ´®¿Ú1·¢ËÍ×Ö·û´®º¯Êý¡£
   74          // ²ÎÊý: puts:  ×Ö·û´®Ö¸Õë.
   75          // ·µ»Ø: none.
   76          // °æ±¾: VER1.0
   77          // ÈÕÆÚ: 2014-11-28
   78          // ±¸×¢: 
   79          //========================================================================
   80          void PrintString1(u8 *puts)
   81          {
   82   1          for (; *puts != 0;  puts++)     //Óöµ½Í£Ö¹·û0½áÊø
   83   1          {
   84   2              while(B_TX1_Busy);
   85   2              B_TX1_Busy = 1;
   86   2              SBUF = *puts;
   87   2          }
   88   1      }
   89          
   90          // ·¢ËÍµ¥¸öÎÞ·ûºÅ32Î»Êý×Ö
   91          void PrintNum1(uint32_t num)
   92          {
   93   1          do
   94   1          {
   95   2              while(B_TX1_Busy);
   96   2              B_TX1_Busy = 1;
   97   2              SBUF = (uint8_t) (num % 10 + '0');
   98   2              num = (uint32_t)(num / 10);
   99   2          }while(num != 0);
  100   1      
  101   1          while(B_TX1_Busy);
  102   1          B_TX1_Busy = 1;
  103   1          SBUF = 0x0A;//·¢ËÍ»Ø³µ
  104   1      }
  105          
  106          void PrintRaw_8(uint16_t rawData)
  107          {
  108   1          while(B_TX1_Busy);
  109   1          B_TX1_Busy = 1;
  110   1          SBUF = rawData;
  111   1      }
  112          
  113          void PrintRaw_16(uint16_t rawData)
  114          {
  115   1          while(B_TX1_Busy);
  116   1          B_TX1_Busy = 1;
  117   1          SBUF = rawData >> 8;
  118   1      
  119   1          while(B_TX1_Busy);
  120   1          B_TX1_Busy = 1;
  121   1          SBUF = rawData;
C251 COMPILER V5.60.0,  Uart1                                                              11/01/26  10:39:44  PAGE 3   

  122   1      }
  123          
  124          void PrintRaw(uint32_t rawData)
  125          {
  126   1          while(B_TX1_Busy);
  127   1          B_TX1_Busy = 1;
  128   1          SBUF = rawData >> 24;
  129   1      
  130   1          while(B_TX1_Busy);
  131   1          B_TX1_Busy = 1;
  132   1          SBUF = rawData >> 16;
  133   1          
  134   1          while(B_TX1_Busy);
  135   1          B_TX1_Busy = 1;
  136   1          SBUF = rawData >> 8;
  137   1      
  138   1          while(B_TX1_Busy);
  139   1          B_TX1_Busy = 1;
  140   1          SBUF = rawData;
  141   1      
  142   1          while(B_TX1_Busy);
  143   1          B_TX1_Busy = 1;
  144   1          SBUF = 0x0A;//·¢ËÍ»Ø³µ 
  145   1      }
  146          
  147          
  148          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       255     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       130     ------
  bit size             =         1     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
