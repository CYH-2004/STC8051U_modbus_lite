C251 COMPILER V5.60.0,  Uart2                                                              11/01/26  10:39:44  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE Uart2
OBJECT MODULE PLACED IN .\Objects\Uart2.obj
COMPILER INVOKED BY: D:\Software_D\Keil_v5\C251\BIN\C251.EXE Basic\Uart2.c XSMALL INTR2 BROWSE INCDIR(.\User;.\Modbus_li
                    -te;.\Library;.\Basic;.\SSD1306) DEBUG PRINT(.\Listings\Uart2.lst) TABS(2) OBJECT(.\Objects\Uart2.obj) 

stmt  level    source

    1          #include "Uart2.h"
    2          
    3          u8  TX2_Cnt;    //发送计数
    4          u8  RX2_Cnt;    //接收计数
    5          bit B_TX2_Busy; //发送忙标志
    6          
    7          u8  RX2_Buffer[UART2_BUF_LENGTH]; //接收缓冲
    8          
    9          void PrintString2(u8 *puts);
   10          void Uart2_PrintRaw_8(uint8_t rawData);
   11          void SetTimer2Baudraye(u32 dat);
   12          void UART2_config(u8 brt);
   13          
   14          //========================================================================
   15          // 函数: void PrintString2(u8 *puts)
   16          // 描述: 串口2发送字符串函数。
   17          // 参数: puts:  字符串指针.
   18          // 返回: none.
   19          // 版本: VER1.0
   20          // 日期: 2014-11-28
   21          // 备注: 
   22          //========================================================================
   23          void PrintString2(u8 *puts)
   24          {
   25   1          for (; *puts != 0;  puts++)     //遇到停止符0结束
   26   1          {
   27   2              while(B_TX2_Busy);
   28   2              S2BUF = *puts;
   29   2              B_TX2_Busy = 1;
   30   2          }
   31   1      }
   32          
   33          void Uart2_PrintRaw_8(uint8_t rawData)
   34          {
   35   1          while(B_TX2_Busy);
   36   1          B_TX2_Busy = 1;
   37   1          S2BUF = rawData;
   38   1      }
   39          
   40          //========================================================================
   41          // 函数: SetTimer2Baudraye(u32 dat)
   42          // 描述: 设置Timer2做波特率发生器。
   43          // 参数: dat: Timer2的重装值.
   44          // 返回: none.
   45          // 版本: VER1.0
   46          // 日期: 2014-11-28
   47          // 备注: 
   48          //========================================================================
   49          void SetTimer2Baudraye(u32 dat)
   50          {
   51   1          T2R = 0;    //Timer stop
   52   1          T2_CT = 0;  //Timer2 set As Timer
   53   1          T2x12 = 1;  //Timer2 set as 1T mode
   54   1          T2H = (u8)(dat / 256);
   55   1          T2L = (u8)(dat % 256);
   56   1          ET2 = 0;    //禁止中断
   57   1          T2R = 1;    //Timer run enable
   58   1      }
C251 COMPILER V5.60.0,  Uart2                                                              11/01/26  10:39:44  PAGE 2   

   59          
   60          //========================================================================
   61          // 函数: void UART2_config(u8 brt)
   62          // 描述: UART2初始化函数。
   63          // 参数: brt: 选择波特率, 2: 使用Timer2做波特率, 其它值: 无效.
   64          // 返回: none.
   65          // 版本: VER1.0
   66          // 日期: 2014-11-28
   67          // 备注: 
   68          //========================================================================
   69          void UART2_config(u8 brt)    // 选择波特率, 2: 使用Timer2做波特率, 其它值: 无效.
   70          {
   71   1          if(brt == 2)
   72   1          {
   73   2              SetTimer2Baudraye(Baudrate2);
   74   2      
   75   2              S2CFG |= 0x01;     //使用串口2时，W1位必需设置为1，否则可能会产生不可预期的错误
   76   2              S2CON = (S2CON & 0x3f) | 0x40;    //UART2模式, 0x00: 同步移位输出, 0x40: 8位数据,可变波特率, 0x80
             -: 9位数据,固定波特率, 0xc0: 9位数据,可变波特率
   77   2              ES2   = 1;         //允许中断
   78   2              S2REN = 1;         //允许接收
   79   2              S2_S  = 1;         //UART2 switch to: 0: P1.2 P1.3,  1: P4.2 P4.3
   80   2      
   81   2              B_TX2_Busy = 0;
   82   2              TX2_Cnt = 0;
   83   2              RX2_Cnt = 0;
   84   2          }
   85   1      }
   86          
   87          //========================================================================
   88          // 函数: void UART2_int (void) interrupt UART2_VECTOR
   89          // 描述: UART2中断函数。
   90          // 参数: nine.
   91          // 返回: none.
   92          // 版本: VER1.0
   93          // 日期: 2014-11-28
   94          // 备注: 
   95          //========================================================================
   96          void UART2_int (void) interrupt 8
   97          {
   98   1          if(S2RI)
   99   1          {
  100   2              S2RI = 0;    //Clear Rx flag
  101   2              RX2_Buffer[RX2_Cnt] = S2BUF;
  102   2              if(++RX2_Cnt >= UART2_BUF_LENGTH)   RX2_Cnt = 0;
  103   2          }
  104   1      
  105   1          if(S2TI)
  106   1          {
  107   2              S2TI = 0;    //Clear Tx flag
  108   2              B_TX2_Busy = 0;
  109   2          }
  110   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       169     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       130     ------
  bit size             =         1     ------
  ebit size            =    ------     ------
C251 COMPILER V5.60.0,  Uart2                                                              11/01/26  10:39:44  PAGE 3   

  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
