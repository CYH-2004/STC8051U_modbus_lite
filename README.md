# STC8051U_modbus_lite

基于STC8051U34K64单片机的Modbus_RTU协议实现

## 2026.1.11  v1.0

版本：v1.0

该版本已支持8个常用命令。单片机时钟选择内部IRC，主频40MHz，使用UART4作为串口进行通信，使用定时器2作波特率发生器，固定波特率115200，不使用奇偶校验。

Modbus协议相关的寄存器地址和寄存器数量可在modbus.h文件中查看和修改。

> 当前已支持的Modbus_RTU协议功能包括:
>
> * (0x01) Read Coils
> * (0x02) Read Discrete Inputs
> * (0x03) Read Holding Registers
> * (0x04) Read Input Registers
> * (0x05) Write Single Coil
> * (0x06) Write Single Register
> * (0x0F) Write Multiple Coils
> * (0x10) Write Multiple Registers

演示程序说明：

演示程序使用自制的核心板，UART4引脚使用P0.0(RxD4)、P0.1(TxD4)。

显示屏使用常见的4针0.96寸OLED屏幕模块(驱动芯片SSD1306)，单片机IIC引脚使用P1.5(SCL)、P1.4(SDA)。

程序功能为主机端控制从机上状态灯的亮灭，灯的亮灭状态通过连接至P3.2的按键控制切换，从机端会对灯的亮起次数进行记录，主机可进行读取。状态灯的亮灭由显示屏模拟，屏幕上同时还会显示状态灯亮起的次数。

在单片机上电时或复位后按下P3.2按键进入从机模式，否则进入主机模式。主机程序支持断连检测和恢复，检测到从机断开连接时会显示正在尝试重连，重连成功后恢复正常显示。

> 演示程序使用的显示屏图形库来自于STC论坛的网友
>
> 原贴链接<https://www.stcaimcu.com/thread-6246-1-2.html>

演示程序运行流程如下:

1. 程序启动后检测连接至P3.2的按键是否按下，按下则进入从机模式，否则进入主机模式，默认从机地址为16;
2. 程序启动后初始设置灯熄灭，计数值清零;
3. 主机循环读取从机灯状态与计数值，并检测按键是否按下，按下则切换从机灯状态；
4. 从机循环处理主机命令，并根据当前灯状态和计数值刷新显示。

> 该项目还有很多改进点，但是由于到期末周了，以后再作说明和修改（其实这个小项目也是为了做现场总线的大作业）。
